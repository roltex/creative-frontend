import{U as d,u as r,V as u}from"./index-CgQqdtoW.js";import{u as l}from"./notifications-0nUPo12q.js";const p=()=>"https://creative-api.buildweb.dev/api",o=d.create({baseURL:p(),timeout:3e4,headers:{"Content-Type":"application/json",Accept:"application/json"}});typeof window<"u"&&setTimeout(()=>{const e=window.__API_BASE_URL__;e&&(o.defaults.baseURL=e)},0);const c=new Map;o.interceptors.request.use(e=>{if(typeof window<"u"&&window.__API_BASE_URL__)e.baseURL=window.__API_BASE_URL__;else{const s=window.location.origin;(s.includes("creative.buildweb.dev")||s.includes("creative-georgia.ge"))&&(e.baseURL="https://creative-api.buildweb.dev/api")}const t=r();t.token&&(e.headers.Authorization=`Bearer ${t.token}`);const i=localStorage.getItem("locale")||"ka";if(e.headers["Accept-Language"]=i,e.retry||(e.retry=3),e.retryDelay||(e.retryDelay=1e3),e.method==="get"){const s=`${e.baseURL}${e.url}${JSON.stringify(e.params||{})}`,a=c.get(s);a&&Date.now()-a.timestamp<a.ttl&&(e.adapter=()=>Promise.resolve({data:a.data,status:200,statusText:"OK",headers:{},config:e,request:{}}))}return e},e=>Promise.reject(e));o.interceptors.response.use(e=>{if(e.config.method==="get"&&e.status===200){const t=`${e.config.baseURL}${e.config.url}${JSON.stringify(e.config.params||{})}`,i=300*1e3;c.set(t,{data:e.data,timestamp:Date.now(),ttl:i})}return e},async e=>{const t=e.config;if(t&&(t.retry??0)>0&&(!e.response||e.response.status>=500||e.code==="NETWORK_ERROR"||e.code==="TIMEOUT"))return t.retry=(t.retry??0)-1,await new Promise(a=>setTimeout(a,t.retryDelay||1e3)),console.log(`Retrying API request: ${t.url} (${t.retry} attempts left)`),o(t);const i=r(),s=l();if(e.response){if(e.response.status===401&&(await i.logout(),u.push({name:"login"}),s.addNotification({id:Date.now().toString(),userId:"",type:"system",title:"Session Expired",message:"Please login again to continue",createdAt:new Date().toISOString()})),e.response.status===403&&s.addNotification({id:Date.now().toString(),userId:"",type:"system",title:"Access Denied",message:"You do not have permission to perform this action",createdAt:new Date().toISOString()}),e.response.status===422){const a=e.response.data.errors;if(a){const n=Object.values(a)[0];Array.isArray(n)&&n.length>0&&(e.message=n[0])}}e.response.status>=500&&s.addNotification({id:Date.now().toString(),userId:"",type:"system",title:"Server Error",message:"Something went wrong. Please try again later.",createdAt:new Date().toISOString()})}else e.request&&s.addNotification({id:Date.now().toString(),userId:"",type:"system",title:"Network Error",message:"Unable to connect to the server. Please check your internet connection.",createdAt:new Date().toISOString()});return Promise.reject(e)});export{o as a};
