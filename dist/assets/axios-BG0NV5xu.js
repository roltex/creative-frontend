import{S as u,u as n,U as d}from"./index-BjBYBXDs.js";import{u as l}from"./notifications-DlAfxpX8.js";const p=()=>"http://localhost:8000/api",i=u.create({baseURL:p(),timeout:3e4,headers:{"Content-Type":"application/json",Accept:"application/json"}}),c=new Map;i.interceptors.request.use(t=>{const e=n();e.token&&(t.headers.Authorization=`Bearer ${e.token}`);const o=localStorage.getItem("locale")||"ka";if(t.headers["Accept-Language"]=o,t.retry||(t.retry=3),t.retryDelay||(t.retryDelay=1e3),t.method==="get"){const a=`${t.baseURL}${t.url}${JSON.stringify(t.params||{})}`,s=c.get(a);s&&Date.now()-s.timestamp<s.ttl&&(t.adapter=()=>Promise.resolve({data:s.data,status:200,statusText:"OK",headers:{},config:t,request:{}}))}return t},t=>Promise.reject(t));i.interceptors.response.use(t=>{if(t.config.method==="get"&&t.status===200){const e=`${t.config.baseURL}${t.config.url}${JSON.stringify(t.config.params||{})}`,o=300*1e3;c.set(e,{data:t.data,timestamp:Date.now(),ttl:o})}return t},async t=>{const e=t.config;if(e&&(e.retry??0)>0&&(!t.response||t.response.status>=500||t.code==="NETWORK_ERROR"||t.code==="TIMEOUT"))return e.retry=(e.retry??0)-1,await new Promise(s=>setTimeout(s,e.retryDelay||1e3)),console.log(`Retrying API request: ${e.url} (${e.retry} attempts left)`),i(e);const o=n(),a=l();if(t.response){if(t.response.status===401&&(await o.logout(),d.push({name:"login"}),a.addNotification({id:Date.now().toString(),userId:"",type:"system",title:"Session Expired",message:"Please login again to continue",createdAt:new Date().toISOString()})),t.response.status===403&&a.addNotification({id:Date.now().toString(),userId:"",type:"system",title:"Access Denied",message:"You do not have permission to perform this action",createdAt:new Date().toISOString()}),t.response.status===422){const s=t.response.data.errors;if(s){const r=Object.values(s)[0];Array.isArray(r)&&r.length>0&&(t.message=r[0])}}t.response.status>=500&&a.addNotification({id:Date.now().toString(),userId:"",type:"system",title:"Server Error",message:"Something went wrong. Please try again later.",createdAt:new Date().toISOString()})}else t.request&&a.addNotification({id:Date.now().toString(),userId:"",type:"system",title:"Network Error",message:"Unable to connect to the server. Please check your internet connection.",createdAt:new Date().toISOString()});return Promise.reject(t)});export{i as a};
