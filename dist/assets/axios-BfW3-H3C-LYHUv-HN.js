import{K as d,h as n,M as u}from"./index-D4giqbAF.js";import{m as p}from"./notifications-Cw33WVIa-BqNy21BL.js";const g=()=>"https://creative-api.buildweb.dev/api",a=d.create({baseURL:g(),timeout:3e4,headers:{"Content-Type":"application/json",Accept:"application/json"}});typeof window<"u"&&setTimeout(()=>{const t=window.__API_BASE_URL__;t&&(a.defaults.baseURL=t)},0);const c=new Map;a.interceptors.request.use(t=>{if(typeof window<"u"&&window.__API_BASE_URL__)t.baseURL=window.__API_BASE_URL__;else{const s=window.location.origin;(s.includes("creative.buildweb.dev")||s.includes("creative-georgia.ge"))&&(t.baseURL="https://creative-api.buildweb.dev/api")}const e=n();e.token&&(t.headers.Authorization=`Bearer ${e.token}`);const r=localStorage.getItem("locale")||"ka";if(t.headers["Accept-Language"]=r,t.retry||(t.retry=3),t.retryDelay||(t.retryDelay=1e3),t.method==="get"){const s=`${t.baseURL}${t.url}${JSON.stringify(t.params||{})}`,o=c.get(s);o&&Date.now()-o.timestamp<o.ttl&&(t.adapter=()=>Promise.resolve({data:o.data,status:200,statusText:"OK",headers:{},config:t,request:{}}))}return t},t=>Promise.reject(t));a.interceptors.response.use(t=>{if(t.config.method==="get"&&t.status===200){const e=`${t.config.baseURL}${t.config.url}${JSON.stringify(t.config.params||{})}`,r=300*1e3;c.set(e,{data:t.data,timestamp:Date.now(),ttl:r})}return t},async t=>{const e=t.config;if(e&&(e.retry??0)>0&&(!t.response||t.response.status>=500||t.code==="NETWORK_ERROR"||t.code==="TIMEOUT"))return e.retry=(e.retry??0)-1,await new Promise(o=>setTimeout(o,e.retryDelay||1e3)),console.log(`Retrying API request: ${e.url} (${e.retry} attempts left)`),a(e);const r=n(),s=p();if(t.response){if(t.response.status===401&&(await r.logout(),u.push({name:"login"}),s.addNotification({id:Date.now().toString(),userId:"",type:"system",title:"Session Expired",message:"Please login again to continue",createdAt:new Date().toISOString()})),t.response.status===403&&s.addNotification({id:Date.now().toString(),userId:"",type:"system",title:"Access Denied",message:"You do not have permission to perform this action",createdAt:new Date().toISOString()}),t.response.status===422){const o=t.response.data.errors;if(o){const i=Object.values(o)[0];Array.isArray(i)&&i.length>0&&(t.message=i[0])}}t.response.status>=500&&s.addNotification({id:Date.now().toString(),userId:"",type:"system",title:"Server Error",message:"Something went wrong. Please try again later.",createdAt:new Date().toISOString()})}else t.request&&s.addNotification({id:Date.now().toString(),userId:"",type:"system",title:"Network Error",message:"Unable to connect to the server. Please check your internet connection.",createdAt:new Date().toISOString()});return Promise.reject(t)});export{a as o};
